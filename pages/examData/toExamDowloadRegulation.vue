<template>
  <div>
    <ZoneTemplate>
      <ZoneTemplateWrapper class="mb-3">
        <section>
          <ZoneTemplateXPadding class="mb-6">
            <h1 class="font-bold tracking-widest text-base-600">112年地方特考簡章下載</h1>
            <hr class="mt-3" />
          </ZoneTemplateXPadding>
          <ZoneTemplateXPadding class="mb-8">
            <table class="w-full table-auto border-collapse text-center">
              <tbody>
                <tr>
                  <td
                    class="w-[30%] border border-solid border-base-300 bg-base-200 p-2 align-middle text-lg font-bold tracking-widest text-base-800"
                  >
                    考試資訊
                  </td>
                  <td
                    class="break-words border border-solid border-base-300 px-1 py-2 text-left align-middle text-lg"
                  >
                    <nuxt-link class="block text-link" to="/examData/toIntroduction/exam_data_id=88"
                      >台中捷運</nuxt-link
                    >
                  </td>
                </tr>
                <tr>
                  <td
                    class="w-[30%] border border-solid border-base-300 bg-base-200 p-2 align-middle text-lg font-bold tracking-widest text-base-800"
                  >
                    報名日期
                  </td>
                  <td
                    class="break-words border border-solid border-base-300 px-1 py-2 text-left align-middle text-lg"
                  >
                    2023-03-17 - 2023-03-27
                  </td>
                </tr>
                <tr>
                  <td
                    class="w-[30%] border border-solid border-base-300 bg-base-200 p-2 align-middle text-lg font-bold tracking-widest text-base-800"
                  >
                    筆試日期
                  </td>
                  <td
                    class="break-words border border-solid border-base-300 px-1 py-2 text-left align-middle text-lg"
                  >
                    2023-04-30 - 2023-04-30
                  </td>
                </tr>
                <tr>
                  <td
                    class="w-[30%] border border-solid border-base-300 bg-base-200 p-2 align-middle text-lg font-bold tracking-widest text-base-800"
                  >
                    面試日期
                  </td>
                  <td
                    class="break-words border border-solid border-base-300 px-1 py-2 text-left align-middle text-lg"
                  >
                    2023-05-20 - 2023-05-20
                  </td>
                </tr>
                <tr>
                  <td
                    class="w-[30%] border border-solid border-base-300 bg-base-200 p-2 align-middle text-lg font-bold tracking-widest text-base-800"
                  >
                    簡章下載
                  </td>
                  <td
                    class="break-words border border-solid border-base-300 px-1 py-2 text-left align-middle text-lg"
                  >
                    <a
                      class="block text-link"
                      href="https://www.tkbtv.com.tw/upload/exam_information_file/8d229b3a20230316093352.pdf?_gl=1*gijclt*_ga*MTYzNzE1NTI0OS4xNjc4NDM5MDkx*_ga_C0JLHTK081*MTY4MjQ5MTQzNi4xNjEuMS4xNjgyNDk1MjY2LjYwLjAuMA..*_ga_XGR3MQW9MD*MTY4MjQ5MTQzNi4xMTkuMS4xNjgyNDk1MjY2LjYwLjAuMA..*_ga_BEN9CE3Q12*MTY4MjQ5MTQzNi4xNDYuMS4xNjgyNDk1MjY2LjYwLjAuMA.."
                      target="_blank"
                      rel="noopener noreferrer"
                      >112年台中捷運簡章簡章下載</a
                    >
                  </td>
                </tr>
                <tr>
                  <td
                    class="w-[30%] border border-solid border-base-300 bg-base-200 p-2 align-middle text-lg font-bold tracking-widest text-base-800"
                  >
                    相關課程
                  </td>
                  <td
                    class="break-words border border-solid border-base-300 px-1 py-2 text-left align-middle text-lg"
                  >
                    <nuxt-link
                      class="mr-2 inline-block text-link"
                      to="/examData/toIntroduction/exam_data_id=88"
                      target="_blank"
                      >捷運全修(五科)(半年)-雲端</nuxt-link
                    >
                    <nuxt-link
                      class="mr-2 inline-block text-link"
                      to="/examData/toIntroduction/exam_data_id=88"
                      target="_blank"
                      >捷運全修(四科)(半年)-雲端</nuxt-link
                    >
                    <nuxt-link
                      class="mr-2 inline-block text-link"
                      to="/examData/toIntroduction/exam_data_id=88"
                      target="_blank"
                      >捷運全修(三科)(半年)-雲端</nuxt-link
                    >
                  </td>
                </tr>
                <tr>
                  <td
                    class="w-[30%] border border-solid border-base-300 bg-base-200 p-2 align-middle text-lg font-bold tracking-widest text-base-800"
                  >
                    免費諮詢
                  </td>
                  <td
                    class="break-words border border-solid border-base-300 px-1 py-2 text-left align-middle text-lg"
                  >
                    <nuxt-link class="block text-link" to="/examData/toIntroduction/exam_data_id=88"
                      >2023捷運招考 | 台北、桃園、台中交通新未來</nuxt-link
                    >
                  </td>
                </tr>
              </tbody>
            </table>
          </ZoneTemplateXPadding>
          <ZoneTemplateXPadding class="mb-8">
            <div class="mb-3">
              <img
                class="h-auto w-full"
                src="https://www.tkbtv.com.tw/p20171124BC010_1100_380/toPic.action"
                alt="2023捷運招考 | 台北、桃園、台中交通新未來"
              />
            </div>
            <h2 class="text-center font-bold tracking-widest">
              2023捷運招考 | 台北、桃園、台中交通新未來
            </h2>
            <hr class="mt-3" />
          </ZoneTemplateXPadding>
          <ZoneTemplateXPadding class="mb-6">
            <PublicForm />
          </ZoneTemplateXPadding>
        </section>
      </ZoneTemplateWrapper>
    </ZoneTemplate>
  </div>
</template>
<script setup>
import ZoneTemplate from '@/components/views/zone/ZoneTemplate.vue'
import ZoneTemplateWrapper from '@/components/views/zone/ZoneTemplateWrapper.vue'
import ZoneTemplateXPadding from '@/components/views/zone/ZoneTemplateXPadding.vue'
import PublicForm from '@/components/form/PublicForm.vue'
definePageMeta({
  layout: 'main'
})
const route = useRoute()
// 取得route query 大分類exam_type_id
const examTypeId = ref(null)
const examId = ref(null)
examTypeId.value = route.query.exam_type_id
examId.value = route.query.exam_data_id

// 引入api資料
let examTypeData = reactive([])
const { data: examRes } = await useApi('/api/exam-section/exam-types/type')
examTypeData = examRes.value.data.examTypes

let ExamsData = reactive([])
const { data: examexamsres } = await useApi('/api/exam-section/exam-types/exams', {
  query: { examTypeId }
})
ExamsData = examexamsres.value.data.exams
// 麵包屑設定
const breadcrumbInfo = ref(null)
watchEffect(() => {
  examTypeId.value = route.query.exam_type_id
  examId.value = route.query.exam_data_id
  const examMainType = computed(() =>
    examTypeData.filter((item) => item.examTypeId === parseInt(examTypeId.value))
  )
  breadcrumbInfo.value = [
    {
      name: examMainType.value[0].examTypeName,
      path: '/examData/toExamList?exam_type_id=' + examTypeId.value
    },
    {
      name: '簡章下載',
      path: '/examData/toexamListRegulations?exam_type_id=' + examTypeId.value
    },
    {
      name: '簡章下載'
    }
  ]
})
provide('passbreadcrumb', breadcrumbInfo)
// newExamsData考試按鈕,*因為Font Awesome資料為舊版本，暫時用假資料examIcon: ['fas', 'school']
const newExamsData = reactive(
  ExamsData.map((item) => {
    return {
      ...item,
      examIcon: ['fas', 'school'],
      toSrc: `/examData/toIntroduction?exam_data_id=${item.examId}&exam_type_id=${examTypeId.value}`
    }
  })
)
const subMenuData = reactive([
  {
    examId: '15186434',
    examName: '簡章下載',
    examIcon: ['fas', 'paste'],
    isActive: false,
    toSrc: `/examData/toexamListRegulations?exam_type_id=${examTypeId.value}`
  },
  {
    examId: '81985168',
    examName: '考古題',
    examIcon: ['fas', 'map'],
    isActive: false,
    toSrc: `/govArchaeology/toDownloadList?exam_type_id=${examTypeId.value}`
  }
])
const subMenu2Data = reactive([
  {
    examId: '15186434',
    examName: '簡章下載',
    examIcon: ['fas', 'paste'],
    isActive: false,
    toSrc: `/examData/toexamListRegulations?exam_type_id=${examTypeId.value}`
  },
  {
    examId: '81985168',
    examName: '考古題',
    examIcon: ['fas', 'paste'],
    toSrc: `/govArchaeology/toDownloadList?exam_type_id=${examTypeId.value}`
  },
  {
    examId: '35832739',
    examName: '線上測驗',
    examIcon: ['fas', 'map'],
    toSrc: `/examData/toBankTest?exam_type_id=${examTypeId.value}`
  }
])
const subMenu3Data = reactive([
  {
    examId: '15186434',
    examName: '簡章下載',
    examIcon: ['fas', 'paste'],
    isActive: false,
    toSrc: `/examData/toexamListRegulations?exam_type_id=${examTypeId.value}`
  },
  {
    examId: '81985168',
    examName: '考古題',
    examIcon: ['fas', 'paste'],
    toSrc: `/govArchaeology/toDownloadDetail?seqno=51&yy=112&exam_type_id=${examTypeId.value}`
  },
  {
    examId: '35832739',
    examName: '線上測驗',
    examIcon: ['fas', 'map'],
    toSrc: `/examData/toBankTest?exam_type_id=${examTypeId.value}`
  }
])
let newSubMenuData = reactive([])
if (examTypeId.value === '3079') {
  newSubMenuData = subMenu3Data
  for (let i = 0; i < newSubMenuData.length; i++) {
    // 比對govArchaeology
    const regexPath = /\/([^/]+)\//
    const matchPath = newSubMenuData[i].toSrc.match(regexPath)
    const thisPath = matchPath[1]
    // 比對exam_type_id的id
    const regexExamType = /exam_type_id=(\d+)/
    const matchId = newSubMenuData[i].toSrc.match(regexExamType)
    const thisExamTypeId = matchId[1]
    if (
      thisPath === route.path.match(regexPath)[1] &&
      thisExamTypeId === route.query.exam_type_id
    ) {
      newSubMenuData[i].isActive = true
    } else {
      newSubMenuData[i].isActive = false
    }
  }
} else if (examTypeId.value === '3128') {
  newSubMenuData = subMenu2Data
  for (let i = 0; i < newSubMenuData.length; i++) {
    // 比對govArchaeology
    const regexPath = /\/([^/]+)\//
    const matchPath = newSubMenuData[i].toSrc.match(regexPath)
    const thisPath = matchPath[1]
    // 比對exam_type_id的id
    const regexExamType = /exam_type_id=(\d+)/
    const matchId = newSubMenuData[i].toSrc.match(regexExamType)
    const thisExamTypeId = matchId[1]
    if (
      thisPath === route.path.match(regexPath)[1] &&
      thisExamTypeId === route.query.exam_type_id
    ) {
      newSubMenuData[i].isActive = true
    } else {
      newSubMenuData[i].isActive = false
    }
  }
} else {
  newSubMenuData = subMenuData

  for (let i = 0; i < newSubMenuData.length; i++) {
    // 比對govArchaeology
    const regexPath = /\/([^/]+)\//
    const matchPath = newSubMenuData[i].toSrc.match(regexPath)
    const thisPath = matchPath[1]
    // 比對exam_type_id的id
    const regexExamType = /exam_type_id=(\d+)/
    const matchId = newSubMenuData[i].toSrc.match(regexExamType)
    const thisExamTypeId = matchId[1]
    if (
      thisPath === route.path.match(regexPath)[1] &&
      thisExamTypeId === route.query.exam_type_id
    ) {
      newSubMenuData[i].isActive = true
    } else {
      newSubMenuData[i].isActive = false
    }
  }
}

provide('passmainmenu', newExamsData)
provide('passsubmenu', newSubMenuData)
provide('passmainmenuwidth', 'md:w-[280px] lg:w-[820px] pr-4')
</script>
<style lang=""></style>
